# `fixed-sqrt`

> Square root functions for fixed-point numbers using integer square root
> algorithm.

This crate implements `sqrt()` as trait methods for fixed point number types
defined in the [`fixed`](https://crates.io/crates/fixed) crate, using the
integer square root algorithm provided by the
[`integer-sqrt`](https://crates.io/crates/integer-sqrt) crate.

## Traits

The square root functionality is split into two traits: `FixedSqrtEven`
(re-exported as `FixedSqrt`) and `FixedSqrtOdd`. This is because the square root
algorithm needs to be specialized for an odd number of fractional bits
(represented as a `typenum` parameter), and generic trait impls don't allow this
kind of specialization based on mutually exclusive traits.

Computing the square root with an odd number of fractional bits requires one
extra bit to shift into before performing the square root. Since square root
is defined only for positive numbers, this can be done for all *signed*
fixed-point numbers (up to and including `FixedI128`) utilizing the sign bit
for the overflow.

For *unsigned* fixed-point numbers with odd fractional bits, if an extra bit
is needed (i.e. if the MSB is 1), this requires a scalar cast to the next
larger unsigned primitive type before computing the square root. As a
result, the square root trait is *not* implemented for `FixedU128` with an
*odd* number fractional bits since that would require 256-bit unsigned
integers, or else the domain would have to be restricted to the lower half
of u128 values.

Square root is also *not* implemented for *signed* fixed-point types with
*zero integer* bits (i.e. fractional bits equal to the total bit size of the
type). This is because the range for these types is *[-0.5, 0.5)*, and
square roots of numbers in the range *[0.25, 0.5)* will be *>= 0.5*, outside
of the range of representable values for that type.

## Accuracy

The `errors` example can be run to see exhaustive error stats for 8-bit and
16-bit fixed-point types. The worst-case absolute error is shown to occur at
the largest values, where the percentage error is small, and the worst-case
percentage error occurs at the smallest values where the absolute error is
small.

CSV files suitable for graphing with gnuplot can also be generated by
running the `errors` example with the `-p` flag.

Generally the square root will be within 1.0 (usually below) of the `f64` square
root, except in the case of large 128-bit numbers where the accuracy of the
fixed-point numbers are better than `f64`, in which case the floating-point
error may be greater than 1.0.

## Panics

- Panics if called on a negative signed number
